<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="content-type"
	content="application/xhtml+xml; charset=UTF-8" />
<title>OCMACO p√©titions</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script src="https://unpkg.com/mithril/mithril.js"></script>
</head>

<body>
    <script src="main.js" defer></script>
  <script>
var MyScore = {
    list: [],
    titre:"",
    description:"",
    categorie:"",
    loadList: function() {
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/petitions"
        })
        .then(function(result) {
            console.log(result)
        })
    },
    top: function() {
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/top"
        })
        .then(function(result) {
            console.log(result)
        })
    },
    test: function() {
        var param = {
                user: "Coco"
            }
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/User",
            params: param
        })
        .then(function(result) {
            console.log(result)
        })
    },
    savePetiton: function() {
        console.log("save")
        
            var data = {
                titre: "Petition 1",
                description: "Desc peee",
                categorie: "cat 1",
                nbsignatures: 1
            }
            var data2 = {
                titre: MyScore.titre,
                description: MyScore.description,
                categorie: MyScore.categorie,
                nbsignatures: 0
            }
            console.log(data)
	        return m.request({
	            method: "post",
	            url: "_ah/api/myApi/v1/postPetition",
                params: data
	        })
            .then(function(result) {
                console.log(data2)
                return m.request({
                    method: "post",
                    url: "_ah/api/myApi/v1/postPetition",
                    params: data2
                })
	        })
	        .then(function(result) {
                console.log(result)
	        	MyScore.loadList()
                MyScore.top()
	        })
              
	}
      
}
var essai = {
    view: function() {
        return m("button", {
            onclick: function(e) {
                MyScore.savePetiton()
            }
        }, "clique1")
    }
}
var test = {
    view: function() {
        return m("button", {
            onclick: function(e) {
                MyScore.test()
            }
        }, "test")
    }
}
var createPetitionForm = {
        view: function() {
            return m("div",{style: "margin-top: 50px"}, [
            m("h5", {class: "text text-center"}, "Creation d'une petition"), 
            m("form",{
                onsubmit: function(e) {
		        e.preventDefault()
		       MyScore.savePetiton()
		      }
            }, [
            m("div", {class: "row"}, [
                m("div", {class: "col-6"}, [
                      m("label.label",{class: "col-form-label"},"* Titre de la petition"),
                      m("input.input[placeholder=Titre]", {class: "form-control",
                      oninput: function (e) {
                       MyScore.titre = e.target.value
                    }
                 }),
                ]),
            ]),  
             m("div", {class: "row"}, [
                 m("div", {class: "col-6"}, [
                     m("label.label", {class: "col-form-label"},"* Categorie"),
                     m("input.input[placeholder=Categorie]", {class: "form-control",
                     oninput: function (e) {
                        MyScore.categorie = e.target.value
                     }
                    }), 
                ]),
            ]),   
            m("label.label",{class: "col-form-label"}, "* Description"),
            m("textarea[placeholder=Description de la petition]", {class: "form-control",
            oninput: function (e) {
                MyScore.description = e.target.value
            },
             rows: "5"
            }),
            m("button.button[type=submit]",{class: "btn btn-success", style: "margin-top: 10px"}, "Lancer"),
        ])
            ])
           
            }
        }
var titre = {
    view: function() {
        return m("div", {class: "container", id: "idi"}, [
            m("h1","hello"),
            m("p","coucou"),
            m(essai),
            m(createPetitionForm),
            m(test)
        ])
    }
}
m.mount(document.body, titre)
</script>  
</body>
</html>