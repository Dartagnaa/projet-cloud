<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="content-type"
	content="application/xhtml+xml; charset=UTF-8" />
<title>OCMACO pétitions</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script src="https://unpkg.com/mithril/mithril.js"></script>
</head>

<body>
    <!--


  
	<h1>Web and Cloud</h1>

Be sure you loaded this page with "https://"

<h2>Check if it works</h2>
	<li><a href='/hello'>The servlet Hello world</a>
	
<h2>Check login Google</h2>	
	<li><a href="https://developers.google.com/identity/sign-in/web/sign-in#before_you_begin">see docs</a>
	<li><a href='/userapi'>Login with Google (servlet)</a>
	<li><a href='/glogin.html'>Login with Google (javascript)</a>
	
	
<h2>Simple Javascript to call Rest Interface</h2>
	<li><a href='/_ah/api/myApi/v1/petition'>REST Call pétition</a>
	<li><a href='/index3.html'>Scores with Mithril</a>
	<li><a href='/index2.html'>Scores with React</a>

<h2>Understanding contention with counters</h2>
	<li><a href='/count'>Counter no transaction</a>
	<li><a href='/counttr'>Counter with transactions</a>
	<li><a href='/countsh'>Sharded Counter with transactions</a>


<h2>Data Queries for managing Friends</h2>	
	<li><a href='/friends'>Populate the Friend table (long)</a>
	<li><a href='/query'>Query the Friend table</a>
	
<h2>Data Queries for managing Posts</h2>	
	<li><a href='/prefixclean'>clean post data (long)</a>
	<li><a href='/prefix'>install post data (long)</a>
	<li><a href='/prefixquery'>Raw queries on post data</a>
    <li><a href='/post.html'>Unsecure MyPost</a>
    <li><a href='/glogin-mithril.html'>Secure MyPost</a>
	<li><a href='/MsgIndex'>Msg - MsgIndex - Key/Parent Key</a>
	
<h2>Data Queries for managing Petitions</h2>	
	<li><a href='/petition'>install petition like data (long)</a>
	<li><a href='/pquery'>query petition data</a>
			

<h1>Fetch scores below:</h1>


		<p id="toto"></p> <script>
    const url = "_ah/api/myApi/v1/pion"
    fetch(url)
    .then(response => response.text())
    .then(data => document.getElementById('toto').innerHTML = data)
  </script>

  -->
  <script>
var MyScore = {
    list: [],
    titre:"",
    description:"",
    categorie:"",
    loadList: function() {
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/petitions"
        })
        .then(function(result) {
            console.log(result)
        })
    },
    top: function() {
        return m.request({
            method: "GET",
            url: "_ah/api/myApi/v1/top"
        })
        .then(function(result) {
            console.log(result)
        })
    },
    savePetiton: function() {
        console.log("save")
        
            var data = {
                titre: "Petition 1",
                description: "Desc peee",
                categorie: "cat 1",
                nbsignatures: 1
            }
            var data2 = {
                titre: MyScore.titre,
                description: MyScore.description,
                categorie: MyScore.categorie,
                nbsignatures: 0
            }
            console.log(data)
	        return m.request({
	            method: "post",
	            url: "_ah/api/myApi/v1/postPetition",
                params: data
	        })
            .then(function(result) {
                console.log(data2)
                return m.request({
                    method: "post",
                    url: "_ah/api/myApi/v1/postPetition",
                    params: data2
                })
	        })
	        .then(function(result) {
                console.log(result)
	        	MyScore.loadList()
                MyScore.top()
	        })
              
	    }
      
}
var essai = {
    view: function() {
        return m("button", {
            onclick: function(e) {
                MyScore.savePetiton()
            }
        }, "clique1")
    }
}
var createPetitionForm = {
        view: function() {
            return m("div",{style: "margin-top: 50px"}, [
            m("h5", {class: "text text-center"}, "Creation d'une petition"), 
            m("form",{
                onsubmit: function(e) {
		        e.preventDefault()
		       MyScore.savePetiton()
		      }
            }, [
            m("div", {class: "row"}, [
                m("div", {class: "col-6"}, [
                      m("label.label",{class: "col-form-label"},"* Titre de la petition"),
                      m("input.input[placeholder=Titre]", {class: "form-control",
                      oninput: function (e) {
                       MyScore.titre = e.target.value
                    }
                 }),
                ]),
            ]),  
             m("div", {class: "row"}, [
                 m("div", {class: "col-6"}, [
                     m("label.label", {class: "col-form-label"},"* Categorie"),
                     m("input.input[placeholder=Categorie]", {class: "form-control",
                     oninput: function (e) {
                        MyScore.categorie = e.target.value
                     }
                    }), 
                ]),
            ]),   
            m("label.label",{class: "col-form-label"}, "* Description"),
            m("textarea[placeholder=Description de la petition]", {class: "form-control",
            oninput: function (e) {
                MyScore.description = e.target.value
            },
             rows: "5"
            }),
            m("button.button[type=submit]",{class: "btn btn-success", style: "margin-top: 10px"}, "Lancer"),
        ])
            ])
           
            }
        }
var titre = {
    view: function() {
        return m("div", {class: "container", id: "idi"}, [
            m("h1","hello"),
            m("p","coucou"),
            m(essai),
            m(createPetitionForm)
        ])
    }
}
m.mount(document.body, titre)
</script>  
</body>
</html>